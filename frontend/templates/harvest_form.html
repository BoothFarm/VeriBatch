{% extends "base.html" %}

{% block title %}Log Harvest - VeriBatch{% endblock %}

{% block content %}
<div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-900">
        ðŸ§º Log Harvest
    </h1>
    <p class="text-gray-600 mt-2">
        Record a harvest and create a new batch of produce from a planting location.
    </p>
</div>

<div class="max-w-2xl">
    <form method="POST" 
          action="/actors/{{ actor_id }}/harvest/create" 
          class="bg-white rounded-xl shadow-lg p-8">
        
        <!-- Planting Event Selection -->
        <div class="mb-6">
            <label class="block text-sm font-semibold text-gray-700 mb-2">
                Linking to Planting (Optional)
            </label>
            <select name="planting_event_id" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                <option value="">Select a recent planting...</option>
                {% for planting in plantings %}
                    <option value="{{ planting.id }}">
                        {{ planting.timestamp[:10] }} - {{ planting.location_name or 'Unknown Location' }} ({{ planting.notes or 'No notes' }})
                    </option>
                {% endfor %}
            </select>
            <p class="text-sm text-gray-500 mt-2">
                Selecting a planting will automatically link this harvest to that location and timeline.
            </p>
        </div>

        <hr class="border-gray-200 my-6">

        <!-- Item -->
        <div class="mb-6">
            <label class="block text-sm font-semibold text-gray-700 mb-2">
                What did you harvest? *
            </label>
            {% if items %}
            <select name="item_id" 
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" 
                    required>
                <option value="">Choose product...</option>
                {% for item in items %}
                <option value="{{ item.id }}">{{ item.name }}</option>
                {% endfor %}
            </select>
            {% else %}
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                <p class="text-yellow-800 mb-3">
                    <strong>No products defined.</strong>
                </p>
                <a href="/actors/{{ actor_id }}/items/new" 
                   class="bg-yellow-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-yellow-700 transition">
                    Add Product First â†’
                </a>
            </div>
            {% endif %}
        </div>

        <!-- Quantity -->
        <div class="mb-6">
            <label class="block text-sm font-semibold text-gray-700 mb-2">
                Quantity Harvested *
            </label>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <input type="number" name="quantity_amount" step="0.01" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                           placeholder="Amount"
                           required>
                </div>
                <div>
                    <select name="quantity_unit" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" required>
                        <option value="">Unit...</option>
                        {% set units = ['kg', 'lb', 'L', 'gal', 'units', 'dozen', 'cases', 'jars', 'bunches'] %}
                        {% for unit in units %}
                        <option value="{{ unit }}">{{ unit }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>

        <!-- Harvest Date -->
        <div class="mb-6">
            <label class="block text-sm font-semibold text-gray-700 mb-2">
                Harvest Date *
            </label>
            <input type="date" name="harvest_date" 
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                   value="{{ now_iso[:10] }}"
                   required>
        </div>

        <!-- Notes -->
        <div class="mb-6">
            <label class="block text-sm font-semibold text-gray-700 mb-2">
                Harvest Notes
            </label>
            <textarea name="notes" rows="3" 
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                      placeholder="e.g., Weather conditions, crew details, quality observations..."></textarea>
        </div>

        <!-- Actions -->
        <div class="flex flex-col sm:flex-row gap-4 mt-8">
            <button type="submit" class="flex-1 bg-green-700 text-white px-8 py-4 rounded-lg font-semibold hover:bg-green-800 focus:outline-none focus:ring-2 focus:ring-green-500 transition shadow-md">
                âœ… Complete Harvest
            </button>
            <a href="/actors/{{ actor_id }}/batches" 
               class="flex-1 text-center bg-gray-100 text-gray-700 px-8 py-4 rounded-lg font-semibold hover:bg-gray-200 transition">
                Cancel
            </a>
        </div>
    </form>
</div>
{% endblock %}
