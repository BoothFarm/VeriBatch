{% extends "base.html" %}

{% block title %}Dashboard - VeriBatch{% endblock %}

{% block content %}

{% if not actors %}
<!-- First-time setup -->
<div class="max-w-2xl mx-auto py-12">
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-900 mb-4 font-serif">ğŸ‰ Welcome to VeriBatch!</h1>
        <p class="text-xl text-gray-600">Let's organize your berry patch (or kitchen).</p>
    </div>
    
    <div class="bg-white rounded-xl shadow-lg p-8 border border-green-100">
        <h2 class="text-2xl font-semibold mb-6 text-green-800">Step 1: Create Your Farm Profile</h2>
        
        <div class="bg-green-50 border border-green-200 rounded-lg p-6 mb-6">
            <h3 class="font-semibold text-green-900 mb-2">What you'll track:</h3>
            <ul class="text-green-800 space-y-2">
                <li>ğŸŒ± <strong>Your harvest & ingredients</strong></li>
                <li>ğŸ·ï¸ <strong>Batch codes (automatically)</strong></li>
                <li>ğŸ“ <strong>Your recipes & processes</strong></li>
                <li>ğŸ“– <strong>The full story from soil to sale</strong></li>
            </ul>
        </div>
        
        <div class="text-center">
            <a href="/actors/new" class="bg-green-700 text-white px-8 py-4 rounded-lg text-lg font-semibold hover:bg-green-800 transition inline-block shadow-md">
                Start Your Journey â†’
            </a>
            <p class="text-sm text-gray-500 mt-3">Takes less than 2 minutes</p>
        </div>
    </div>
</div>

{% else %}

<!-- Header with business info -->
<div class="bg-gradient-to-r from-green-600 to-green-700 text-white rounded-xl p-8 mb-8">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
            <h1 class="text-3xl font-bold">{{ stats.actor.name }}</h1>
            <p class="text-green-100 mt-1">Production Dashboard</p>
        </div>
        
        <div class="flex items-center gap-6">
            <!-- System Status Widget -->
            <div class="hidden lg:block text-right">
                <span class="block text-xs uppercase tracking-wider text-green-200 font-bold">System Status</span>
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-900 text-green-100 border border-green-500">
                    <svg class="mr-1.5 h-2 w-2 text-green-400" fill="currentColor" viewBox="0 0 8 8">
                        <circle cx="4" cy="4" r="3" />
                    </svg>
                    Self-Hosted Instance
                </span>
            </div>

            {% if actors|length > 1 %}
            <form action="/dashboard" method="GET">
                <label for="actor_switch" class="sr-only">Switch Farm</label>
                <select id="actor_switch" name="actor_id" onchange="this.form.submit()" 
                        class="text-sm bg-green-800 border border-green-500 text-white rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-400 cursor-pointer shadow-sm hover:bg-green-700 transition">
                    {% for a in actors %}
                    <option value="{{ a.id }}" {% if a.id == current_actor_id %}selected{% endif %}>
                        {{ a.name }}
                    </option>
                    {% endfor %}
                </select>
            </form>
            {% endif %}
            
            <div class="text-right border-l border-green-500 pl-6">
                <div class="text-3xl font-bold leading-none">{{ stats.active_batches }}</div>
                <div class="text-sm text-green-100 font-medium">Active Batches</div>
            </div>
        </div>
    </div>
</div>

{% if stats.batches_count == 0 %}
<!-- Zero State Welcome Card -->
<div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden mb-8">
    <div class="bg-gradient-to-r from-amber-50 to-white p-8 border-b border-gray-100">
        <h2 class="text-2xl font-bold text-gray-900 mb-2 font-serif">Let's get your records started!</h2>
        <p class="text-gray-600">You have your farm profile, now it's time to add your first batch. Choose how you want to start:</p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 divide-y md:divide-y-0 md:divide-x divide-gray-100">
        <div class="p-8 hover:bg-gray-50 transition group cursor-pointer" onclick="window.location='/actors/{{ stats.actor.id }}/batches/new'">
            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mb-4 group-hover:bg-green-200 transition">
                <span class="text-2xl">âœï¸</span>
            </div>
            <h3 class="text-lg font-bold text-gray-900 mb-2">Start Simple</h3>
            <p class="text-sm text-gray-500 mb-4">Create your first batch manually. Best for getting a feel for the system.</p>
            <span class="text-green-700 font-medium text-sm group-hover:underline">Create Manual Batch â†’</span>
        </div>
        
        <div class="p-8 hover:bg-gray-50 transition group cursor-pointer" onclick="alert('CSV Import coming in next release! For now, please use manual entry.')">
            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-4 group-hover:bg-blue-200 transition">
                <span class="text-2xl">ğŸ“‚</span>
            </div>
            <h3 class="text-lg font-bold text-gray-900 mb-2">Import Data</h3>
            <p class="text-sm text-gray-500 mb-4">Have a spreadsheet? Upload a CSV to bulk-import your existing inventory.</p>
            <span class="text-blue-700 font-medium text-sm group-hover:underline">Upload CSV â†’</span>
        </div>
    </div>
</div>
{% endif %}

<!-- Alert/Status Section -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <!-- Alerts -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
            <span class="text-amber-500 mr-2">âš ï¸</span>
            Alerts & Notifications
        </h2>
        <div class="space-y-3">
            {% if stats.active_batches == 0 %}
            <!-- Only show if we didn't show the big card above, or as a persistent reminder -->
            <div class="bg-blue-50 border-l-4 border-blue-400 p-3 rounded">
                <p class="text-blue-800 text-sm">
                    <strong>Welcome!</strong> Use the buttons above to add your first batch.
                </p>
            </div>
            {% endif %}
            
            {% if stats.items_count == 0 %}
            <div class="bg-amber-50 border-l-4 border-amber-400 p-3 rounded">
                <p class="text-amber-800 text-sm">
                    <strong>Add products first:</strong> Define your items before creating batches.
                </p>
            </div>
            {% endif %}
            
            {% if stats.items_count > 0 and stats.batches_count == 0 %}
            <div class="bg-green-50 border-l-4 border-green-400 p-3 rounded">
                <p class="text-green-800 text-sm">
                    <strong>Great!</strong> Items created. Now add your first batch with a lot code.
                </p>
            </div>
            {% endif %}
            
            {% if stats.active_batches > 0 and stats.events_count == 0 %}
            <div class="bg-purple-50 border-l-4 border-purple-400 p-3 rounded">
                <p class="text-purple-800 text-sm">
                    <strong>Level up:</strong> Start logging production events for full traceability.
                </p>
            </div>
            {% endif %}
            
            {% if stats.active_batches > 0 and stats.events_count > 0 %}
            <div class="bg-green-50 border-l-4 border-green-400 p-3 rounded">
                <p class="text-green-800 text-sm">
                    <strong>Excellent!</strong> You're tracking everything. Ready for any inspection.
                </p>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Quick Stats -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Your Numbers</h2>
        <div class="grid grid-cols-2 gap-4">
            <div class="text-center bg-gray-50 rounded-lg p-4">
                <div class="text-2xl font-bold text-gray-900">{{ stats.items_count }}</div>
                <div class="text-sm text-gray-600">Products</div>
            </div>
            <div class="text-center bg-gray-50 rounded-lg p-4">
                <div class="text-2xl font-bold text-gray-900">{{ stats.batches_count }}</div>
                <div class="text-sm text-gray-600">Total Batches</div>
            </div>
            <div class="text-center bg-gray-50 rounded-lg p-4">
                <div class="text-2xl font-bold text-gray-900">{{ stats.events_count }}</div>
                <div class="text-sm text-gray-600">Events Logged</div>
            </div>
            <div class="text-center bg-gray-50 rounded-lg p-4">
                <div class="text-2xl font-bold text-gray-900">{{ stats.processes_count }}</div>
                <div class="text-sm text-gray-600">Recipes</div>
            </div>
        </div>
    </div>
</div>

<!-- Action Cards -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    
    <!-- Quick Create -->
    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500">
        <h3 class="font-semibold text-gray-900 mb-4 flex items-center">
            <span class="text-green-500 mr-2">âš¡</span>
            Quick Actions
        </h3>
        <div class="space-y-3">
            <a href="/actors/{{ stats.actor.id }}/events/new?event_type=planting" 
               class="block bg-green-700 text-white px-4 py-2 rounded text-sm font-medium hover:bg-green-800 transition text-center">
                ğŸŒ± Log Planting
            </a>
            <a href="/actors/{{ stats.actor.id }}/harvest/new" 
               class="block bg-orange-600 text-white px-4 py-2 rounded text-sm font-medium hover:bg-orange-700 transition text-center">
                ğŸ§º Log Harvest
            </a>
            <a href="/actors/{{ stats.actor.id }}/batches/new" 
               class="block bg-green-600 text-white px-4 py-2 rounded text-sm font-medium hover:bg-green-700 transition text-center">
                + New Batch
            </a>
            <a href="/actors/{{ stats.actor.id }}/items/new" 
               class="block bg-blue-600 text-white px-4 py-2 rounded text-sm font-medium hover:bg-blue-700 transition text-center">
                + Add Product
            </a>
            <a href="/actors/{{ stats.actor.id }}/production-run/new" 
               class="block bg-purple-600 text-white px-4 py-2 rounded text-sm font-medium hover:bg-purple-700 transition text-center">
                ğŸ­ Production Run
            </a>
            <a href="/actors/{{ stats.actor.id }}/split-batch/new" 
               class="block bg-orange-600 text-white px-4 py-2 rounded text-sm font-medium hover:bg-orange-700 transition text-center">
                âœ‚ï¸ Split Batch
            </a>
            <a href="/actors/{{ stats.actor.id }}/merge-batch/new" 
               class="block bg-indigo-600 text-white px-4 py-2 rounded text-sm font-medium hover:bg-indigo-700 transition text-center">
                ğŸ”— Merge Batches
            </a>
        </div>
    </div>
    
    <!-- View & Manage -->
    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500">
        <h3 class="font-semibold text-gray-900 mb-4 flex items-center">
            <span class="text-blue-500 mr-2">ğŸ“‹</span>
            View & Manage
        </h3>
        <div class="space-y-2">
            <a href="/actors/{{ stats.actor.id }}/batches" 
               class="block text-blue-700 hover:text-blue-800 hover:bg-blue-50 px-2 py-1 rounded text-sm">
                All Batches ({{ stats.batches_count }})
            </a>
            <a href="/actors/{{ stats.actor.id }}/items" 
               class="block text-blue-700 hover:text-blue-800 hover:bg-blue-50 px-2 py-1 rounded text-sm">
                Products ({{ stats.items_count }})
            </a>
            <a href="/actors/{{ stats.actor.id }}/events" 
               class="block text-blue-700 hover:text-blue-800 hover:bg-blue-50 px-2 py-1 rounded text-sm">
                Event History
            </a>
            <a href="/actors/{{ stats.actor.id }}/processes" 
               class="block text-blue-700 hover:text-blue-800 hover:bg-blue-50 px-2 py-1 rounded text-sm">
                Recipes & SOPs
            </a>
        </div>
    </div>
    
    <!-- Traceability -->
    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-purple-500">
        <h3 class="font-semibold text-gray-900 mb-4 flex items-center">
            <span class="text-purple-500 mr-2">ğŸ”</span>
            Traceability
        </h3>
        <div class="space-y-2">
            <a href="/actors/{{ stats.actor.id }}/traceability" 
               class="block text-purple-700 hover:text-purple-800 hover:bg-purple-50 px-2 py-1 rounded text-sm">
                Trace Any Batch
            </a>
            <a href="/actors/{{ stats.actor.id }}/batches?status=active" 
               class="block text-purple-700 hover:text-purple-800 hover:bg-purple-50 px-2 py-1 rounded text-sm">
                Active Inventory
            </a>
            <div class="text-xs text-gray-500 mt-2 px-2">
                Track from farm to shelf in seconds
            </div>
        </div>
    </div>
    
    <!-- Export & Reports -->
    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-amber-500">
        <h3 class="font-semibold text-gray-900 mb-4 flex items-center">
            <span class="text-amber-500 mr-2">ğŸ“Š</span>
            Reports & Export
        </h3>
        <div class="space-y-2">
            <a href="/api/actors/{{ stats.actor.id }}/export/ooj-archive" 
               class="block bg-amber-600 text-white px-3 py-2 rounded text-sm font-medium hover:bg-amber-700 transition text-center">
                Export All Data
            </a>
            <a href="/docs" 
               class="block text-amber-700 hover:text-amber-800 hover:bg-amber-50 px-2 py-1 rounded text-sm">
                API Access
            </a>
            <div class="text-xs text-gray-500 mt-2 px-2">
                Ready for inspectors & auditors
            </div>
        </div>
    </div>
</div>

<!-- Inspection Readiness Banner -->
<div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg p-6 text-center">
    <h2 class="text-xl font-semibold mb-2">ğŸ›¡ï¸ Inspection Ready</h2>
    <p class="text-blue-100 mb-4">
        Your traceability system meets food safety requirements. 
        Export reports instantly when inspectors arrive.
    </p>
    <a href="/api/actors/{{ stats.actor.id }}/export/ooj-archive" 
       class="bg-white text-blue-600 px-6 py-2 rounded font-semibold hover:bg-gray-100 transition">
        Generate Inspection Report â†’
    </a>
</div>

{% endif %}
{% endblock %}
